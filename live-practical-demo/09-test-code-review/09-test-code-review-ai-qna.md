# Test Code Review AI Q&A

## Me:

```markdown
ä½ æ˜¯è½¯ä»¶æµ‹è¯•ä¸“å®¶ã€‚è¯·ä½ æŒ‰ç…§ä¸‹è¿°è¯„å®¡å†…å®¹è¦æ±‚ä¾æ¬¡è¯„å®¡saleorå†’çƒŸæµ‹è¯•åŠå…¶æ•…éšœæ³¨å…¥æµ‹è¯•çš„æµ‹è¯•ç”¨ä¾‹è®¾è®¡å’Œæµ‹è¯•ä»£ç æ˜¯å¦ç¬¦åˆ2025å¹´å…¬è®¤çš„Web UIæµ‹è¯•çš„æœ€ä½³å®è·µã€‚ä¸‹é¢æ˜¯è¯„å®¡å†…å®¹ï¼š1ï¼‰è¯„ä»·å†’çƒŸæµ‹è¯•çš„æµ‹è¯•ç”¨ä¾‹è®¾è®¡ï¼ˆå‚è§ @04-test-scenario-design.md  ï¼‰æ˜¯å¦èƒ½è¦†ç›–ç”µå•†ç³»ç»Ÿä¸­æœ€å¸¸è§çš„å†’çƒŸåœºæ™¯ï¼Œå¹¶ç»™å‡ºæ”¹è¿›å»ºè®®ï¼›2ï¼‰å†’çƒŸæµ‹è¯•ä»£ç  @system-basics.smoke.spec.ts ä¸­çš„æµ‹è¯•ç”¨ä¾‹æ˜¯å¦å®Œæ•´å¹¶å‡†ç¡®è¦†ç›–äº† @04-test-scenario-design/ ä¸­å†’çƒŸæµ‹è¯•çš„æ‰€æœ‰åœºæ™¯ï¼Œå¹¶ç»™å‡ºæ”¹è¿›å»ºè®®ï¼›3ï¼‰å†’çƒŸæµ‹è¯•ä»£ç  @system-basics.smoke.spec.ts ä¸­çš„æµ‹è¯•ä»£ç æ˜¯å¦ç¬¦åˆ2025å¹´å…¬è®¤çš„Web UIæµ‹è¯•æœ€ä½³å®è·µï¼Œå¹¶ç»™å‡ºæ”¹è¿›å»ºè®®ï¼›4ï¼‰ @08-fault-injection-testing-for-smoke-tests.md ä¸­çš„æ•…éšœæ³¨å…¥æµ‹è¯•ç”¨ä¾‹è®¾è®¡æ˜¯å¦èƒ½æœ‰æ•ˆéªŒè¯ @04-test-scenario-design/ ä¸­æ‰€åˆ—å‡ºçš„å†’çƒŸæµ‹è¯•ç”¨ä¾‹æ‰€è¦†ç›–çš„æœ‰æ•ˆæ€§ï¼Œå¹¶ç»™å‡ºæ”¹è¿›å»ºè®®ã€‚
```

## Cursor with Claude sonnet 4:

æˆ‘å°†æŒ‰ç…§æ‚¨çš„è¦æ±‚ï¼Œä»å››ä¸ªæ–¹é¢è¯„å®¡Saleorå†’çƒŸæµ‹è¯•åŠå…¶æ•…éšœæ³¨å…¥æµ‹è¯•ã€‚é¦–å…ˆè®©æˆ‘ä»”ç»†åˆ†æç›¸å…³æ–‡æ¡£å’Œä»£ç ã€‚

[3 tools called]

ç°åœ¨è®©æˆ‘æŸ¥çœ‹Page Objectsçš„å®ç°æ¥æ›´å…¨é¢åœ°è¯„ä¼°æµ‹è¯•ä»£ç ï¼š

[3 tools called]

è®©æˆ‘ä¹ŸæŸ¥çœ‹BasePageæ¥äº†è§£åŸºç¡€è®¾æ–½ï¼š

[1 tool called]

ç°åœ¨è®©æˆ‘æ£€æŸ¥Playwrighté…ç½®ä»¥äº†è§£æµ‹è¯•è®¾ç½®ï¼š

[1 tool called]

ç°åœ¨æˆ‘æœ‰äº†å®Œæ•´çš„è¯„å®¡ä¿¡æ¯ï¼Œè®©æˆ‘æä¾›è¯¦ç»†çš„è¯„å®¡æŠ¥å‘Šï¼š

# Saleorå†’çƒŸæµ‹è¯•åŠæ•…éšœæ³¨å…¥æµ‹è¯•è¯„å®¡æŠ¥å‘Š

## 1. å†’çƒŸæµ‹è¯•ç”¨ä¾‹è®¾è®¡è¯„ä»· 

### âœ… ä¼˜åŠ¿åˆ†æ

**è¦†ç›–èŒƒå›´è‰¯å¥½**ï¼š
- åŸºæœ¬è¦†ç›–äº†ç”µå•†ç³»ç»Ÿçš„æ ¸å¿ƒæµç¨‹ï¼šé¦–é¡µ â†’ äº§å“è¯¦æƒ… â†’ è´­ç‰©è½¦ â†’ ç»“è´¦
- æµ‹è¯•ç”¨ä¾‹è®¾è®¡éµå¾ªGiven-When-Thenæ ¼å¼ï¼Œç»“æ„æ¸…æ™°

**æµ‹è¯•åˆ†å±‚åˆç†**ï¼š
- å†’çƒŸæµ‹è¯•ä¸“æ³¨åŸºç¡€åŠŸèƒ½éªŒè¯
- Happy Pathè¦†ç›–å®Œæ•´è´­ç‰©æµç¨‹
- Sad Pathå…³æ³¨APIå±‚é¢çš„é”™è¯¯å¤„ç†

### âŒ å…³é”®ç¼ºé™·

**ç”µå•†ç³»ç»Ÿå†’çƒŸæµ‹è¯•è¦†ç›–ä¸å®Œæ•´**ï¼š

1. **ç¼ºå°‘æ€§èƒ½ç›¸å…³çš„å†’çƒŸæµ‹è¯•**ï¼š
   - é¡µé¢åŠ è½½æ—¶é—´éªŒè¯ï¼ˆé¦–é¡µ3ç§’å†…åŠ è½½ï¼‰
   - äº§å“å›¾ç‰‡åŠ è½½éªŒè¯
   - æœç´¢åŠŸèƒ½å“åº”æ—¶é—´

2. **ç¼ºå°‘å…³é”®ä¸šåŠ¡åœºæ™¯**ï¼š
   - ç”¨æˆ·ç™»å½•/æ³¨å†ŒåŠŸèƒ½
   - äº§å“æœç´¢å’Œè¿‡æ»¤
   - åº“å­˜çŠ¶æ€æ˜¾ç¤º
   - ä»·æ ¼è®¡ç®—å‡†ç¡®æ€§

3. **ç¼ºå°‘ç§»åŠ¨ç«¯é€‚é…éªŒè¯**ï¼š
   - å“åº”å¼å¸ƒå±€æ£€æŸ¥
   - è§¦æ‘¸äº¤äº’éªŒè¯

### ğŸ’¡ æ”¹è¿›å»ºè®®

```gherkin
# è¡¥å……æ€§èƒ½ç›¸å…³å†’çƒŸæµ‹è¯•
Given: Saleorå¹³å°å·²å¯åŠ¨
When: è®¿é—®storefronté¦–é¡µ
Then: é¡µé¢åº”åœ¨3ç§’å†…å®ŒæˆåŠ è½½
  And: æ‰€æœ‰äº§å“å›¾ç‰‡åº”æˆåŠŸæ˜¾ç¤º

# è¡¥å……ç”¨æˆ·è®¤è¯å†’çƒŸæµ‹è¯•
Given: ç”¨æˆ·åœ¨ä»»æ„é¡µé¢
When: ç‚¹å‡»ç™»å½•é“¾æ¥
Then: ç™»å½•é¡µé¢åº”æˆåŠŸåŠ è½½
  And: ç™»å½•è¡¨å•åº”æ­£ç¡®æ˜¾ç¤º

# è¡¥å……æœç´¢åŠŸèƒ½å†’çƒŸæµ‹è¯•
Given: ç”¨æˆ·åœ¨é¦–é¡µ
When: åœ¨æœç´¢æ¡†è¾“å…¥"tee"å¹¶æäº¤
Then: æœç´¢ç»“æœé¡µåº”æ˜¾ç¤ºç›¸å…³äº§å“
  And: æœç´¢ç»“æœåº”åœ¨2ç§’å†…è¿”å›
```

## 2. å†’çƒŸæµ‹è¯•ä»£ç è¦†ç›–è¯„ä»·

### âœ… ä¼˜åŠ¿åˆ†æ

**Page Objectæ¨¡å¼å®ç°è‰¯å¥½**ï¼š
- ä½¿ç”¨äº†BasePageæŠ½è±¡ç±»ï¼Œä»£ç å¤ç”¨æ€§å¥½
- é¡µé¢å¯¹è±¡å°è£…åˆç†ï¼ŒèŒè´£åˆ†ç¦»æ¸…æ™°

**Playwrightæœ€ä½³å®è·µåº”ç”¨**ï¼š
- ä½¿ç”¨äº†å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
- åˆç†é…ç½®äº†è¶…æ—¶æ—¶é—´
- å®ç°äº†æˆªå›¾å’Œè°ƒè¯•æ”¯æŒ

### âŒ å…³é”®ç¼ºé™·

**æµ‹è¯•è¦†ç›–ä¸å®Œæ•´**ï¼š

1. **TC-003æµ‹è¯•é€»è¾‘æœ‰é—®é¢˜**ï¼š
```typescript
// å½“å‰ä»£ç é—®é¢˜ï¼šcatchå—å¯¼è‡´æµ‹è¯•æ°¸ä¸å¤±è´¥
try {
  await productPage.addToCartWithSpecs('S', 1);
  // æ­£å¸¸éªŒè¯é€»è¾‘
} catch (error) {
  // è¿™é‡Œä½¿ç”¨test.skipå¯¼è‡´æµ‹è¯•è·³è¿‡è€Œä¸æ˜¯å¤±è´¥
  test.skip(!!error, 'Add to cart functionality requires product variant selection');
}
```

2. **é”™è¯¯å¤„ç†ä¸ç¬¦åˆå†’çƒŸæµ‹è¯•åŸåˆ™**ï¼š
   - å†’çƒŸæµ‹è¯•åº”è¯¥åœ¨åŸºç¡€åŠŸèƒ½å¤±è´¥æ—¶æ˜ç¡®æŠ¥é”™
   - å½“å‰ä»£ç è¿‡äºå®½å®¹ï¼Œæ©ç›–äº†çœŸå®é—®é¢˜

3. **ç¼ºå°‘å®é™…æ•°æ®éªŒè¯**ï¼š
   - TC-004å’ŒTC-005åªéªŒè¯é¡µé¢åŠ è½½ï¼ŒæœªéªŒè¯åŠŸèƒ½å®Œæ•´æ€§

### ğŸ’¡ æ”¹è¿›å»ºè®®

```typescript
// ä¿®å¤TC-003çš„é”™è¯¯å¤„ç†
test('TC-003: Add to cart functionality should work correctly', async () => {
  // Given: User is on product detail page
  await homePage.goto();
  await homePage.clickFirstProduct();
  await productPage.verifyProductPageLoaded();

  // When: User selects product specs and clicks "Add to Cart"
  await productPage.selectAnyVariant(); // ç¡®ä¿é€‰æ‹©äº†å˜ä½“
  await productPage.clickAddToCart();

  // Then: Cart icon should show updated quantity
  await homePage.goto();
  const cartBadgeVisible = await homePage.waitForCartBadge(5000);
  
  // å†’çƒŸæµ‹è¯•åº”è¯¥æ˜ç¡®éªŒè¯æ ¸å¿ƒåŠŸèƒ½
  expect(cartBadgeVisible).toBe(true);
  
  const cartCount = await homePage.getCartBadgeCount();
  expect(cartCount).toBeGreaterThan(0);
});
```

## 3. æµ‹è¯•ä»£ç æœ€ä½³å®è·µè¯„ä»·

### âœ… ç¬¦åˆ2025å¹´æœ€ä½³å®è·µçš„éƒ¨åˆ†

**æ¶æ„è®¾è®¡**ï¼š
- âœ… ä½¿ç”¨TypeScriptæä¾›ç±»å‹å®‰å…¨
- âœ… é‡‡ç”¨Page Object Modelæ¨¡å¼
- âœ… å®ç°äº†æµ‹è¯•æ•°æ®å’Œé¡µé¢é€»è¾‘åˆ†ç¦»

**æµ‹è¯•æ‰§è¡Œ**ï¼š
- âœ… é…ç½®äº†åˆç†çš„è¶…æ—¶æ—¶é—´
- âœ… æ”¯æŒå¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
- âœ… é›†æˆäº†å¤šç§æŠ¥å‘Šæ ¼å¼

**è°ƒè¯•æ”¯æŒ**ï¼š
- âœ… æä¾›æˆªå›¾åŠŸèƒ½
- âœ… æœ‰æ¸…æ™°çš„æµ‹è¯•æè¿°

### âŒ ä¸ç¬¦åˆæœ€ä½³å®è·µçš„éƒ¨åˆ†

**1. ç¼ºå°‘æµ‹è¯•æ•°æ®ç®¡ç†**ï¼š
```typescript
// ç°çŠ¶ï¼šç¡¬ç¼–ç æµ‹è¯•æ•°æ®
await productPage.addToCartWithSpecs('S', 1);

// å»ºè®®ï¼šä½¿ç”¨æµ‹è¯•æ•°æ®å·¥å‚
class TestDataFactory {
  static getProductVariant() {
    return {
      size: 'S',
      quantity: 1,
      expectedPrice: '$20.00'
    };
  }
}
```

**2. ç¼ºå°‘ç¯å¢ƒæ¸…ç†**ï¼š
```typescript
// å»ºè®®æ·»åŠ æµ‹è¯•æ¸…ç†
test.afterEach(async ({ page }) => {
  // æ¸…ç†è´­ç‰©è½¦çŠ¶æ€
  await page.goto('/cart');
  await cartPage.clearCart();
});
```

**3. æ–­è¨€ä¸å¤Ÿå…·ä½“**ï¼š
```typescript
// ç°çŠ¶ï¼šè¿‡äºå®½æ³›çš„æ–­è¨€
await expect(this.productList).toBeVisible();

// å»ºè®®ï¼šæ›´å…·ä½“çš„æ–­è¨€
await expect(this.productList).toBeVisible();
await expect(this.productCards).toHaveCountGreaterThan(0);
await expect(this.productCards.first()).toContainText(/\$\d+/); // éªŒè¯ä»·æ ¼æ ¼å¼
```

**4. ç¼ºå°‘APIçº§åˆ«çš„éªŒè¯**ï¼š
```typescript
// å»ºè®®æ·»åŠ ç½‘ç»œå±‚éªŒè¯
test('TC-001: Homepage API responses are healthy', async ({ page }) => {
  const responses: Response[] = [];
  
  page.on('response', response => {
    if (response.url().includes('/graphql')) {
      responses.push(response);
    }
  });
  
  await homePage.goto();
  
  // éªŒè¯GraphQLè¯·æ±‚æˆåŠŸ
  const graphqlResponses = responses.filter(r => r.status() === 200);
  expect(graphqlResponses.length).toBeGreaterThan(0);
});
```

## 4. æ•…éšœæ³¨å…¥æµ‹è¯•è®¾è®¡è¯„ä»·

### âœ… ä¼˜åŠ¿åˆ†æ

**è®¾è®¡æ€è·¯æ­£ç¡®**ï¼š
- æ¯ä¸ªæ•…éšœæ³¨å…¥æµ‹è¯•å¯¹åº”ä¸€ä¸ªå†’çƒŸæµ‹è¯•
- éªŒè¯ç›®æ ‡æ˜ç¡®ï¼Œä¸“æ³¨äºéªŒè¯æµ‹è¯•çš„æœ‰æ•ˆæ€§

**æ•…éšœåœºæ™¯è¦†ç›–å…¨é¢**ï¼š
- æ¶µç›–äº†æ•°æ®å±‚ã€APIå±‚ã€ç½‘ç»œå±‚ã€å‰ç«¯èµ„æºå±‚çš„æ•…éšœ

### âŒ å…³é”®ç¼ºé™·

**1. ç¼ºå°‘å…·ä½“å®ç°æ–¹æ¡ˆ**ï¼š
```markdown
# ç°çŠ¶ï¼šåªæœ‰æ¦‚å¿µæè¿°
And: äº§å“æ•°æ®åº“å·²è¢«æ¸…ç©ºï¼ˆæ‰§è¡Œæ•°æ®åº“æ¸…ç†ï¼Œåˆ é™¤æ‰€æœ‰productsè¡¨æ•°æ®ï¼‰

# å»ºè®®ï¼šæä¾›å…·ä½“å®ç°
And: æ‰§è¡ŒSQLæ¸…ç†è„šæœ¬ 'DELETE FROM products; DELETE FROM product_variants;'
And: ä½¿ç”¨Dockerå‘½ä»¤é‡å¯æ•°æ®åº“æœåŠ¡ä¸”ä¸åŠ è½½ç¤ºä¾‹æ•°æ®
```

**2. ç¼ºå°‘è‡ªåŠ¨åŒ–æ‰§è¡Œæ–¹æ¡ˆ**ï¼š
- æ•…éšœæ³¨å…¥åº”è¯¥èƒ½å¤Ÿè‡ªåŠ¨åŒ–æ‰§è¡Œ
- éœ€è¦æä¾›æ•…éšœæ¢å¤æœºåˆ¶

**3. ç¼ºå°‘è¾¹ç•Œæƒ…å†µéªŒè¯**ï¼š
```markdown
# å»ºè®®è¡¥å……æ›´å¤šæ•…éšœåœºæ™¯
FI-TC-008: ç½‘ç»œå»¶è¿Ÿè¶…æ—¶éªŒè¯
Given: ç½‘ç»œå»¶è¿Ÿè¢«è®¾ç½®ä¸º10ç§’
When: ç”¨æˆ·è®¿é—®ä»»ä½•é¡µé¢
Then: é¡µé¢åº”åœ¨è¶…æ—¶æ—¶é—´å†…æ˜¾ç¤ºåŠ è½½é”™è¯¯

FI-TC-009: æœåŠ¡å™¨è¿‡è½½éªŒè¯  
Given: åç«¯æœåŠ¡è¢«é™åˆ¶CPUå’Œå†…å­˜èµ„æº
When: å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®
Then: åº”ç”¨åº”ä¼˜é›…é™çº§è€Œä¸æ˜¯å´©æºƒ
```

### ğŸ’¡ æ”¹è¿›å»ºè®®

**1. æä¾›è‡ªåŠ¨åŒ–å®ç°è„šæœ¬**ï¼š
```bash
#!/bin/bash
# fi-tc-001-execute.sh
echo "æ‰§è¡ŒFI-TC-001: äº§å“æ•°æ®åº“æ¸…ç©ºæµ‹è¯•"

# å¤‡ä»½å½“å‰æ•°æ®
docker exec saleor-db pg_dump -U saleor > backup.sql

# æ¸…ç©ºäº§å“æ•°æ®
docker exec saleor-db psql -U saleor -c "TRUNCATE products CASCADE;"

# è¿è¡Œå†’çƒŸæµ‹è¯•ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
npm run test:smoke -- --grep "TC-001"

# æ¢å¤æ•°æ®
docker exec saleor-db psql -U saleor < backup.sql
```

**2. é›†æˆåˆ°CI/CDæµæ°´çº¿**ï¼š
```yaml
# .github/workflows/fault-injection.yml
name: Fault Injection Tests
on: [pull_request]
jobs:
  fault-injection:
    runs-on: ubuntu-latest
    steps:
      - name: Run FI-TC-001
        run: ./fi-tc-001-execute.sh
      - name: Verify test failure
        run: |
          if [ $? -eq 0 ]; then
            echo "ERROR: Smoke test should have failed but passed"
            exit 1
          fi
```

## æ€»ç»“ä¸ä¼˜å…ˆçº§å»ºè®®

### ğŸ”¥ é«˜ä¼˜å…ˆçº§æ”¹è¿›ï¼ˆç«‹å³æ‰§è¡Œï¼‰

1. **ä¿®å¤TC-003çš„é”™è¯¯å¤„ç†é€»è¾‘**ï¼Œç¡®ä¿å†’çƒŸæµ‹è¯•èƒ½æ­£ç¡®å¤±è´¥
2. **è¡¥å……ç”¨æˆ·è®¤è¯å’Œæœç´¢åŠŸèƒ½çš„å†’çƒŸæµ‹è¯•**
3. **å®ç°æ•…éšœæ³¨å…¥æµ‹è¯•çš„è‡ªåŠ¨åŒ–è„šæœ¬**

### ğŸ“ˆ ä¸­ä¼˜å…ˆçº§æ”¹è¿›ï¼ˆè¿‘æœŸæ‰§è¡Œï¼‰

1. **æ·»åŠ æ€§èƒ½ç›¸å…³çš„å†’çƒŸæµ‹è¯•**
2. **å®ç°æµ‹è¯•æ•°æ®å·¥å‚æ¨¡å¼**
3. **å¢å¼ºæ–­è¨€çš„å…·ä½“æ€§å’Œå‡†ç¡®æ€§**

### ğŸ¯ ä½ä¼˜å…ˆçº§æ”¹è¿›ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

1. **æ·»åŠ APIçº§åˆ«çš„éªŒè¯**
2. **å®ç°ç§»åŠ¨ç«¯é€‚é…æµ‹è¯•**
3. **é›†æˆæ•…éšœæ³¨å…¥æµ‹è¯•åˆ°CI/CDæµæ°´çº¿**

è¿™ä¸ªæµ‹è¯•å¥—ä»¶æ•´ä½“æ¶æ„è‰¯å¥½ï¼Œä½†åœ¨ç»†èŠ‚å®ç°å’Œè¦†ç›–å®Œæ•´æ€§æ–¹é¢è¿˜æœ‰è¾ƒå¤§æ”¹è¿›ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç¡®ä¿å†’çƒŸæµ‹è¯•èƒ½å¤ŸçœŸæ­£"é—»åˆ°çƒŸå‘³"æ—¶æŠ¥è­¦ã€‚